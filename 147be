Imports System.IO
Imports System.Text
Imports System.Text.RegularExpressions
Imports System.Threading

Public Class frm_APP_SearchForm
    Private mvStr_AppPath As String = Application.StartupPath()
    Private mvDic_DirectoryInfo As New IO.DirectoryInfo(mvStr_AppPath)
    Private mvFso_GetAllFileIdx As IO.FileInfo() = mvDic_DirectoryInfo.GetFiles("*.idx")
    Private mvLst_StreamReaderIdx As New List(Of StreamReader)
    Private mvDic_PathDataFile As New IO.DirectoryInfo(mvStr_AppPath + "\DATA")
    Private mvFso_GetAllFileDat As IO.FileInfo() = mvDic_PathDataFile.GetFiles("*.DAT")
    Private mvLst_ListWorkType As New List(Of String)
    Private mvInt_TotalTextBoxNotNull As Integer = 0
    Private mvLst_WorkTypeNameFromIni As New List(Of String)
    Private mvLst_ListDataGridView As New List(Of String)
    Private mvLst_ListLineWordDetail As List(Of String)
    Private mvLst_ListLineInFileConfigIni() As String
    Private mvLst_ListIdWorkTypeFromListBox As New List(Of String)

    Private Sub subM_APP_CheckExistFileIni()
        mvLst_ListLineInFileConfigIni = File.ReadAllLines(mvStr_AppPath + "\config.ini")
        mvLst_ListLineWordDetail = fncM_APP_GetIniWorkTypeNameLineInFileIni("[WorkTypeDetail]", "[DenpyoType]")
        mvLst_WorkTypeNameFromIni = fncM_APP_GetIniWorkTypeNameLineInFileIni("[WorkType]", "[WorkTypeDetail]")
    End Sub

    Private mvThr_CheckFileExist As New Thread(AddressOf subM_APP_CheckExistFileIni)

    'Get list line tu key1 den key 2 trong file ini co chua dau '='
    Private Function fncM_APP_GetIniWorkTypeNameLineInFileIni(ByVal iStr_Position1 As String, ByVal iStr_Position2 As String) As List(Of String)

        Dim wLst_ListWorkType As New List(Of String)
        For m As Integer = 0 To mvLst_ListLineInFileConfigIni.Length - 1 Step +1
            If mvLst_ListLineInFileConfigIni(m) = iStr_Position1 Then
                For n As Integer = m + 2 To mvLst_ListLineInFileConfigIni.Length - 1 Step +1
                    Dim wMth_Compare As Match = Regex.Match(mvLst_ListLineInFileConfigIni(n),
                                         "=",
                                         RegexOptions.IgnoreCase)
                    If wMth_Compare.Success Then
                        wLst_ListWorkType.Add(mvLst_ListLineInFileConfigIni(n))
                    End If
                    If mvLst_ListLineInFileConfigIni(n) = iStr_Position2 Then
                        Exit For
                    End If
                Next n
            End If
        Next m
        Return wLst_ListWorkType
    End Function
    'Tu 1 list Line cho truoc lay ra mot dong co chua Key Sau Do Lay Name
    Private Function fncM_APP_GetIniWorkTypeName(ByVal iLst_ListLineInPut As List(Of String), Key As String) As String
        Dim wStr_StringNameWordType As String = ""
        Dim wInt_FlagI As Integer
        For i As Integer = 0 To iLst_ListLineInPut.Count - 1 Step +1
            If InStr(iLst_ListLineInPut(i), Key) Then
                wInt_FlagI = i
                Dim wStr_GetName As New StringBuilder()
                For Each c As Char In iLst_ListLineInPut(i)
                    If [Char].IsLetter(c) Or c = " " Then
                        wStr_GetName.Append(c)
                    End If
                Next
                wStr_StringNameWordType = wStr_GetName.ToString
                Exit For
            End If
        Next i
        Return wStr_StringNameWordType
    End Function
    'Intput TextBox.text
    'KEY la do dai chuoi qui dinh trong file int
    'Return chuoi co so 0 dang truoc neu Textbox.text ko du gia tri 
    Private Function fncM_APP_GetTextValue(ByVal iStr_TextInput As String, iInt_LenghtMaxTextBox As Integer) As String
        Dim wStr_ValueText As String = ""
        Dim wStr_GetTextLengthInput As Integer
        wStr_GetTextLengthInput = iStr_TextInput.Length
        For i As Integer = 0 To iInt_LenghtMaxTextBox - wStr_GetTextLengthInput - 1 Step +1
            wStr_ValueText = wStr_ValueText + "0"
        Next i
        wStr_ValueText = wStr_ValueText + iStr_TextInput
        Return wStr_ValueText
    End Function

    Private Function fncM_APP_LineCheckDateTime(ByVal iStr_LineInput As String, ByVal iDtm_DayStart As Date, ByVal iDtm_DayFinish As Date) As Boolean
        Dim wLst_ListValOfLine() As String
        'val(0) : date value
        wLst_ListValOfLine = iStr_LineInput.ToString().Split("	")
        Dim wStr_GetDateValue As String
        wStr_GetDateValue = wLst_ListValOfLine(0)
        Dim wDtm_DayNeedCheck As Date
        Dim wStr_Year As String
        Dim wStr_Month As String
        Dim wStr_Day As String
        wStr_Year = wStr_GetDateValue(0) + wStr_GetDateValue(1) + wStr_GetDateValue(2) + wStr_GetDateValue(3)
        wStr_Month = wStr_GetDateValue(4) + wStr_GetDateValue(5)
        wStr_Day = wStr_GetDateValue(6) + wStr_GetDateValue(7)
        wDtm_DayNeedCheck = New Date(Convert.ToInt32(wStr_Year), Convert.ToInt32(wStr_Month), Convert.ToInt32(wStr_Day))
        If wDtm_DayNeedCheck >= iDtm_DayStart And wDtm_DayNeedCheck <= iDtm_DayFinish Then
            Return True
        End If
        Return False
    End Function
    'Get String tu vi tri so key1 den vi tri so key 2
    Private Function fncM_APP_GetStringFromTwoPosition(ByVal iStr_LineInput As String, ByVal iInt_Position1 As Integer, ByVal iInt_Position2 As Integer) As String
        Dim wStr_Result As String = ""
        For i As Integer = iInt_Position1 To iInt_Position2 Step +1
            wStr_Result = wStr_Result + iStr_LineInput(i)
        Next i
        Return wStr_Result
    End Function
    'Return list WorkTypeId From ListWorkTypeName selected
    Private Function fncM_APP_GetIdWorkTypeFromListBox() As List(Of String)
        Dim wLst_ListWordTypeId As New List(Of String)
        Dim wLst_LineWorkTypeTemp As New List(Of String)
        'lineWorkTypeTemp = getIniWorkTypeNameLine("[WorkType]", "[WorkTypeDetail]")
        For k As Integer = 0 To mvLst_WorkTypeNameFromIni.Count - 1 Step +1
            wLst_LineWorkTypeTemp.Add(mvLst_WorkTypeNameFromIni(k))
        Next k
        For j As Integer = 0 To mvLst_ListWorkType.Count - 1 Step +1
            For i As Integer = 0 To wLst_LineWorkTypeTemp.Count - 1 Step +1
                If wLst_LineWorkTypeTemp(i).Contains(mvLst_ListWorkType(j)) Then
                    wLst_ListWordTypeId.Add(fncM_APP_GetStringFromTwoPosition(wLst_LineWorkTypeTemp(i), 2, 5))
                    wLst_LineWorkTypeTemp.RemoveAt(i)
                    i = i - 1
                    Exit For
                End If
            Next i
        Next j
        Return wLst_ListWordTypeId
    End Function
    'Check check 1 String co nam trong 1 ListString hay khong
    Private Function fncM_APP_CheckStringExistInListString(ByVal iInt_ListInput As List(Of String), ByVal iStr_KeyWord As String) As Boolean
        For i As Integer = 0 To iInt_ListInput.Count - 1 Step +1
            If iInt_ListInput(i) = iStr_KeyWord Then
                Return True
            End If
        Next i
        Return False
    End Function
    Private Function fncM_APP_LineCheckListBox(ByVal iStr_LineInput As String) As Boolean
        Dim wStr_IdWorkType() As String
        'val(5) : id worktype
        wStr_IdWorkType = iStr_LineInput.ToString().Split("	")
        Dim wstr_IdWorkTypeDetail As String = ""
        wstr_IdWorkTypeDetail = fncM_APP_GetStringFromTwoPosition(wStr_IdWorkType(5), 0, 3)
        Dim wLst_ListListBoxValue As New List(Of String)
        wLst_ListListBoxValue = mvLst_ListIdWorkTypeFromListBox           '1'
        Return fncM_APP_CheckStringExistInListString(wLst_ListListBoxValue, wstr_IdWorkTypeDetail)
    End Function
    Private Function fncM_APP_CheckTextBoxNotNull(ByVal iStr_TextBox As String) As Boolean
        If iStr_TextBox <> "0" Then
            Return True
        Else
            Return False
        End If
    End Function
    Private Function fncM_APP_LineCheckText(ByVal iStr_LineCheck As String, ByVal iStr_TextBox1 As String, ByVal iStr_TextBox2 As String, ByVal iStr_TextBox3 As String) As Boolean
        Dim wStr_ValueFromLine() As String
        wStr_ValueFromLine = iStr_LineCheck.ToString().Split("	")
        If mvInt_TotalTextBoxNotNull = 0 Then
            Return True
        End If
        If iStr_TextBox1 = wStr_ValueFromLine(1) And iStr_TextBox3 = wStr_ValueFromLine(3) And iStr_TextBox2 = wStr_ValueFromLine(2) Then
            Return True
        End If
        If mvInt_TotalTextBoxNotNull = 1 Then
            If iStr_TextBox1 = wStr_ValueFromLine(1) Then
                Return True
            End If
            If iStr_TextBox2 = wStr_ValueFromLine(2) Then
                Return True
            End If
            If iStr_TextBox3 = wStr_ValueFromLine(3) Then
                Return True
            End If
        End If
        If mvInt_TotalTextBoxNotNull = 2 Then
            If iStr_TextBox1 = wStr_ValueFromLine(1) And iStr_TextBox2 = wStr_ValueFromLine(2) Then
                Return True
            End If
            If iStr_TextBox1 = wStr_ValueFromLine(1) And iStr_TextBox3 = wStr_ValueFromLine(3) Then
                Return True
            End If
            If iStr_TextBox3 = wStr_ValueFromLine(3) And iStr_TextBox2 = wStr_ValueFromLine(2) Then
                Return True
            End If
        End If
        Return False
    End Function

    Private Sub subM_APP_SetDefaultDateTime()
        Dim wStr_FirstFileIdxName As String = ""
        wStr_FirstFileIdxName = mvFso_GetAllFileIdx(0).Name
        Dim wStr_Year As String
        Dim wStr_Month As String
        Dim wStr_Day As String
        wStr_Year = wStr_FirstFileIdxName(0) + wStr_FirstFileIdxName(1) + wStr_FirstFileIdxName(2) + wStr_FirstFileIdxName(3)
        wStr_Month = wStr_FirstFileIdxName(4) + wStr_FirstFileIdxName(5)
        wStr_Day = wStr_FirstFileIdxName(6) + wStr_FirstFileIdxName(7)
        dtmStart.Value = New Date(Convert.ToInt32(wStr_Year), Convert.ToInt32(wStr_Month), Convert.ToInt32(wStr_Day))
    End Sub

    Private Sub mnsQuit_Click(sender As Object, e As EventArgs) Handles mnsQuit.Click

        Close()

    End Sub
    Private mvInt_FlagClose As Integer = 0

    Private Sub txtShopCode_Click(sender As Object, e As EventArgs) Handles txtShopCode.Click
        txtShopCode.SelectAll()
    End Sub
    Private Sub txtPosNo_Click(sender As Object, e As EventArgs) Handles txtPosNo.Click
        txtPosNo.SelectAll()
    End Sub
    Private Sub txtReceiptCode_Click(sender As Object, e As EventArgs) Handles txtReceiptCode.Click
        txtReceiptCode.SelectAll()
    End Sub
    Private Sub txtShopCode_TextChanged(sender As Object, e As EventArgs) Handles txtShopCode.TextChanged
        If txtShopCode.TextLength = 0 Then
            txtShopCode.Text = 0
            txtShopCode.SelectAll()
        End If
    End Sub
    Private Sub txtPosNo_TextChanged(sender As Object, e As EventArgs) Handles txtPosNo.TextChanged
        If txtPosNo.TextLength = 0 Then
            txtPosNo.Text = 0
            txtPosNo.SelectAll()
        End If
    End Sub
    Private Sub txtReceiptCode_TextChanged(sender As Object, e As EventArgs) Handles txtReceiptCode.TextChanged
        If txtReceiptCode.TextLength = 0 Then
            txtReceiptCode.Text = 0
            txtReceiptCode.SelectAll()
        End If
    End Sub
    Private Sub txtShopCode_KeyPress(sender As Object, e As KeyPressEventArgs) Handles txtShopCode.KeyPress
        If Not Char.IsDigit(e.KeyChar) And Not e.KeyChar = Chr(Keys.Back) Then
            e.Handled = True
        End If
        If txtShopCode.TextLength = 1 And e.KeyChar = "0" And txtShopCode.Text = "0" Then
            e.Handled = True
        End If
    End Sub
    Private Sub txtPosNo_KeyPress(sender As Object, e As KeyPressEventArgs) Handles txtPosNo.KeyPress
        If Not Char.IsDigit(e.KeyChar) And Not e.KeyChar = Chr(Keys.Back) Then
            e.Handled = True
        End If
        If txtShopCode.TextLength = 1 And e.KeyChar = "0" And txtPosNo.Text = "0" Then
            e.Handled = True
        End If
    End Sub
    Private Sub txtReceiptCode_KeyPress(sender As Object, e As KeyPressEventArgs) Handles txtReceiptCode.KeyPress
        If Not Char.IsDigit(e.KeyChar) And Not e.KeyChar = Chr(Keys.Back) Then
            e.Handled = True
        End If
        If txtShopCode.TextLength = 1 And e.KeyChar = "0" And txtReceiptCode.Text = "0" Then
            e.Handled = True
        End If
    End Sub

    Private Function fncM_APP_DeleteChar0(ByVal iStr_StringNeedDelete As String) As String
        Dim wStr_Result As String = ""
        Dim wInt_CountChar0 As Integer = 0
        For i As Integer = 0 To iStr_StringNeedDelete.Length - 1 Step +1
            If iStr_StringNeedDelete(i) <> "0" Then
                wInt_CountChar0 = i
                Exit For
            End If
        Next
        For j As Integer = wInt_CountChar0 To iStr_StringNeedDelete.Length - 1 Step +1
            wStr_Result = wStr_Result + iStr_StringNeedDelete(j)
        Next j
        Return wStr_Result
    End Function
    Private Function fncM_APP_DayFormatInReceipt(ByVal iStr_DateStringInput As String) As String
        Dim wStr_Result As String = ""
        wStr_Result = iStr_DateStringInput(0) + iStr_DateStringInput(1) + iStr_DateStringInput(2) + iStr_DateStringInput(3) + "/" + iStr_DateStringInput(4) + iStr_DateStringInput(5) + "/" + iStr_DateStringInput(6) + iStr_DateStringInput(7)
        Return wStr_Result
    End Function


    '---------------------------------------------------------------------------------------------------------
    'Private Sub cmdSearch_Click(sender As Object, e As EventArgs) Handles cmdSearch.Click
    '    'Button1.Text = "Cancel (E)"
    '    listIdWorkTypeFromListBox = getIdWorkTypeFromListBox()
    '    mvInt_TotalTextBoxNotNull = 0
    '    If Check(txtShopCode.Text.ToString) Then
    '        mvInt_TotalTextBoxNotNull = mvInt_TotalTextBoxNotNull + 1
    '    End If
    '    If Check(txtPosNo.Text.ToString) Then
    '        mvInt_TotalTextBoxNotNull = mvInt_TotalTextBoxNotNull + 1
    '    End If
    '    If Check(txtReceiptCode.Text.ToString) Then
    '        mvInt_TotalTextBoxNotNull = mvInt_TotalTextBoxNotNull + 1
    '    End If
    '    Dim tableDataGrid As New DataTable()
    '    'Datagridview
    '    tableDataGrid.Columns.Add("WorkType", Type.GetType("System.String"))
    '    tableDataGrid.Columns.Add("Date", Type.GetType("System.String"))
    '    tableDataGrid.Columns.Add("Shop CODE", Type.GetType("System.String"))
    '    tableDataGrid.Columns.Add("Pos NO", Type.GetType("System.String"))
    '    tableDataGrid.Columns.Add("Receipt Code", Type.GetType("System.String"))
    '    tableDataGrid.Columns.Add("Manage Code", Type.GetType("System.String"))
    '    dgvInformationRecord.DataSource = tableDataGrid
    '    '--------------------------------------------------------------------
    '    'If Flag Mod 2 = 0 Then
    '    '    Button1.Text = "Search (S)"
    '    'Else
    '    '    Button1.Text = "Cancel (E)"
    '    'End If
    '    'Cancel
    '    '--------------------------------------------------------------------------
    '    'Search
    '    Dim list As List(Of String)
    '    list = GetAllLineAfterSearch()
    '    Dim valsDataGrid() As String
    '    For x As Integer = 0 To list.Count - 1 Step +1
    '        If tableDataGrid.Rows.Count > 2999 Then
    '            MsgBox("Not Over 3000", MsgBoxStyle.OkOnly Or MsgBoxStyle.Exclamation,
    '                "Warning")
    '            Exit For
    '        End If
    '        valsDataGrid = list(x).ToString().Split("	")
    '        listDataGridView.Add(list(x))
    '        Dim row(valsDataGrid.Length - 5) As String
    '        'row(0) = valsDataGrid(valsDataGrid.Length - 5).Trim()
    '        Dim typeWordId As String = ""
    '        typeWordId = valsDataGrid(valsDataGrid.Length - 5).Trim()
    '        row(0) = getIniWorkTypeName(lineWordDetail, typeWordId)
    '        '-------------------------------------------------------------------
    '        For y As Integer = 1 To valsDataGrid.Length - 5 Step +1
    '            row(y) = valsDataGrid(y - 1).Trim()
    '        Next y
    '        tableDataGrid.Rows.Add(row)
    '    Next x
    '    lblTotalRecord.Text = "Total Record: " + tableDataGrid.Rows.Count.ToString
    'End Sub
    ''get ALL line afterSeach By text
    'Private Function GetAllLineAfterSearch() As List(Of String)
    '    Dim day1 As Date
    '    Dim day2 As Date
    '    day1 = dtmStart.Value
    '    day2 = dtmFinish.Value
    '    Dim key1 As String = txtShopCode.Text
    '    Dim key2 As String = txtPosNo.Text
    '    Dim key3 As String = txtReceiptCode.Text
    '    If key1 <> "0" Then
    '        key1 = getTextValue(txtShopCode.Text, 4)
    '    End If
    '    If key2 <> "0" Then
    '        key2 = getTextValue(txtPosNo.Text, 2)
    '    End If
    '    If key3 <> "0" Then
    '        key3 = getTextValue(txtReceiptCode.Text, 8)
    '    End If
    '    Dim lineData As New List(Of String)
    '    For f As Integer = 0 To mvFso_GetAllFileIdx.Length - 1 Step +1
    '        Using objReader As New StreamReader(mvStr_AppPath + "\" + mvFso_GetAllFileIdx(f).Name)          '1
    '            Do While objReader.Peek() <> -1
    '                Dim Line As String = objReader.ReadLine()
    '                'Check TextBox---------------ListBox---------------DateTime--------------------------
    '                'If lineCheckText(Line, key1, key2, key3) And lineCheckListBox(Line) And lineCheckDateTime(Line, day1, day2) Then
    '                '    lineData.Add(Line)
    '                'End If
    '                '---------------------------------------------------------------------
    '                If lineCheckDateTime(Line, day1, day2) Then                                 '2'
    '                    If lineCheckText(Line, key1, key2, key3) Then                            '3'
    '                        If lineCheckListBox(Line) Then                                       '4
    '                            lineData.Add(Line)
    '                        End If
    '                    End If
    '                End If
    '            Loop
    '            objReader.Close()
    '        End Using
    '        'Using listStreamReaderIdx(f)
    '        '    Do While listStreamReaderIdx(f).Peek() <> -1
    '        '        Dim Line As String = listStreamReaderIdx(f).ReadLine()
    '        '        If lineCheckDateTime(Line, day1, day2) Then
    '        '            If lineCheckText(Line, key1, key2, key3) Then
    '        '                If lineCheckListBox(Line) Then
    '        '                    lineData.Add(Line)
    '        '                End If
    '        '            End If
    '        '        End If
    '        '    Loop
    '        'End Using
    '    Next f
    '    Return lineData
    'End Function
    '---------------------------------------------------------------------------------------------------------------
    Private mvInt_EventSearchCancel As Integer = 0
    Private Sub subM_APP_GetAllLineAfterSearch()

        If mvInt_EventSearchCancel Mod 2 = 0 Then
            lblTotalRecord.Text = "Total Record: "
            cmdSearch.Text = "Cancel(E)"
            mvInt_EventSearchCancel = mvInt_EventSearchCancel + 1
            Dim wDtm_DayStart As Date
            Dim wDtm_DayFinish As Date
            wDtm_DayStart = dtmStart.Value
            wDtm_DayFinish = dtmFinish.Value
            Dim wStr_TextBoxShopCode As String = txtShopCode.Text
            Dim wStr_TexBoxPosNo As String = txtPosNo.Text
            Dim wStr_TextBoxReceiptCode As String = txtReceiptCode.Text
            If wStr_TextBoxShopCode <> "0" Then
                wStr_TextBoxShopCode = fncM_APP_GetTextValue(txtShopCode.Text, 4)
            End If
            If wStr_TexBoxPosNo <> "0" Then
                wStr_TexBoxPosNo = fncM_APP_GetTextValue(txtPosNo.Text, 2)
            End If
            If wStr_TextBoxReceiptCode <> "0" Then
                wStr_TextBoxReceiptCode = fncM_APP_GetTextValue(txtReceiptCode.Text, 8)
            End If
            Dim wTbl_TableDataGrid As New DataTable()
            'Datagridview
            wTbl_TableDataGrid.Columns.Add("WorkType", Type.GetType("System.String"))
            wTbl_TableDataGrid.Columns.Add("Date", Type.GetType("System.String"))
            wTbl_TableDataGrid.Columns.Add("Shop CODE", Type.GetType("System.String"))
            wTbl_TableDataGrid.Columns.Add("Pos NO", Type.GetType("System.String"))
            wTbl_TableDataGrid.Columns.Add("Receipt Code", Type.GetType("System.String"))
            wTbl_TableDataGrid.Columns.Add("Manage Code", Type.GetType("System.String"))
            dgvInformationRecord.DataSource = wTbl_TableDataGrid
            Dim wInt_DoEventTemp As Integer = 0
            Dim wInt_FinishOpenFile As Integer = 0
            Dim wInt_DatagridCountTemp As Integer = 0
            For f As Integer = 0 To mvFso_GetAllFileIdx.Length - 1 Step +1
                Using wFso_ObjReader As New StreamReader(mvStr_AppPath + "\" + mvFso_GetAllFileIdx(f).Name)          '1
                    Do While wFso_ObjReader.Peek() <> -1
                        If mvInt_EventSearchCancel Mod 2 = 0 Then
                            Exit For
                        End If
                        wInt_DoEventTemp = wInt_DoEventTemp + 1
                        wInt_DatagridCountTemp = wInt_DatagridCountTemp + dgvInformationRecord.RowCount
                        Dim wStr_ReadLine As String = wFso_ObjReader.ReadLine()
                        If fncM_APP_LineCheckDateTime(wStr_ReadLine, wDtm_DayStart, wDtm_DayFinish) Then                                 '2'
                            If fncM_APP_LineCheckText(wStr_ReadLine, wStr_TextBoxShopCode, wStr_TexBoxPosNo, wStr_TextBoxReceiptCode) Then                            '3'
                                If fncM_APP_LineCheckListBox(wStr_ReadLine) Then                                       '4

                                    If dgvInformationRecord.Rows.Count > 3000 Then
                                        MsgBox("Not Over 3000", MsgBoxStyle.OkOnly Or MsgBoxStyle.Exclamation,
                                        "Warning")
                                        mvInt_EventSearchCancel = mvInt_EventSearchCancel + 1
                                        cmdSearch.Text = "Search(S)"
                                        lblTotalRecord.Text = "Total Record: 3000"
                                        wInt_FinishOpenFile = 1
                                        Exit For
                                    End If
                                    Dim wStr_ValueDataGrid() As String
                                    wStr_ValueDataGrid = wStr_ReadLine.ToString().Split("	")
                                    mvLst_ListDataGridView.Add(wStr_ReadLine)
                                    Dim wStr_RowDataGrid(wStr_ValueDataGrid.Length - 5) As String
                                    Dim typeWordId As String = ""
                                    typeWordId = wStr_ValueDataGrid(wStr_ValueDataGrid.Length - 5).Trim()
                                    wStr_RowDataGrid(0) = fncM_APP_GetIniWorkTypeName(mvLst_ListLineWordDetail, typeWordId)
                                    For y As Integer = 1 To wStr_ValueDataGrid.Length - 5 Step +1
                                        wStr_RowDataGrid(y) = wStr_ValueDataGrid(y - 1).Trim()
                                    Next y
                                    wTbl_TableDataGrid.Rows.Add(wStr_RowDataGrid)
                                    'System.Threading.Thread.Sleep(0)
                                    'Application.DoEvents()
                                    'Application.ExitThread()
                                End If
                            End If
                        End If
                        If wInt_DoEventTemp Mod 100 = 0 Then
                            Application.DoEvents()
                        End If

                    Loop
                    wFso_ObjReader.Close()
                End Using
                If f = mvFso_GetAllFileIdx.Length - 1 Then
                    mvInt_EventSearchCancel = mvInt_EventSearchCancel + 1
                    cmdSearch.Text = "Search(S)"
                    lblTotalRecord.Text = "Total Record: " + (dgvInformationRecord.Rows.Count - 1).ToString
                End If
                If wInt_FinishOpenFile = 1 Then
                    Exit For
                End If
            Next f

        Else
            mvInt_EventSearchCancel = mvInt_EventSearchCancel + 1
            cmdSearch.Text = "Search(S)"
            lblTotalRecord.Text = "Total Record: " + (dgvInformationRecord.Rows.Count - 1).ToString
        End If
    End Sub
    Private Sub cmdSearch_Click(sender As Object, e As EventArgs) Handles cmdSearch.Click
        rtbReceiptDetail.Clear()
        'Button1.Text = "Cancel (E)"
        mvLst_ListIdWorkTypeFromListBox = fncM_APP_GetIdWorkTypeFromListBox()
        mvInt_TotalTextBoxNotNull = 0
        If fncM_APP_CheckTextBoxNotNull(txtShopCode.Text.ToString) Then
            mvInt_TotalTextBoxNotNull = mvInt_TotalTextBoxNotNull + 1
        End If
        If fncM_APP_CheckTextBoxNotNull(txtPosNo.Text.ToString) Then
            mvInt_TotalTextBoxNotNull = mvInt_TotalTextBoxNotNull + 1
        End If
        If fncM_APP_CheckTextBoxNotNull(txtReceiptCode.Text.ToString) Then
            mvInt_TotalTextBoxNotNull = mvInt_TotalTextBoxNotNull + 1
        End If
        subM_APP_GetAllLineAfterSearch()
    End Sub

    Private Sub frm_APP_SearchForm_Load(sender As Object, e As EventArgs) Handles MyBase.Load

        For f As Integer = 0 To mvFso_GetAllFileIdx.Length - 1 Step +1
            Dim objReader As New StreamReader(mvStr_AppPath + "\" + mvFso_GetAllFileIdx(f).Name)
            mvLst_StreamReaderIdx.Add(objReader)
        Next f
        'Set key press = true
        Me.KeyPreview = True
        '--------------------
        'Check exist .IDK
        Dim wInt_TotalFileIdx As Integer
        wInt_TotalFileIdx = mvFso_GetAllFileIdx.Length
        If wInt_TotalFileIdx = 0 Then
            MsgBox("Not Found IDX FILE", MsgBoxStyle.OkOnly Or MsgBoxStyle.Critical,
               "Warning")
            Close()
        End If
        '-------------------------------------------------------
        'Check .ini
        Dim wFso_CountFileIni As IO.FileInfo() = mvDic_DirectoryInfo.GetFiles("*.ini")
        Dim wInt_TotalFileIni As Integer
        wInt_TotalFileIni = wFso_CountFileIni.Length
        If wInt_TotalFileIni = 0 Then
            MsgBox("Not Found INI FILE", MsgBoxStyle.OkOnly Or MsgBoxStyle.Critical,
               "Warning")
            Close()
        End If

        mvThr_CheckFileExist.Start()
        '-------------------------------------------------------
        'WorkType In ListBox
        Dim wList_ListLineInFileIni() As String
        wList_ListLineInFileIni = File.ReadAllLines(mvStr_AppPath + "\config.ini")
        For m As Integer = 0 To wList_ListLineInFileIni.Length - 1 Step +1
            If wList_ListLineInFileIni(m) = "[WorkType]" Then
                For n As Integer = m + 2 To wList_ListLineInFileIni.Length - 1 Step +1
                    Dim wMth_Compare As Match = Regex.Match(wList_ListLineInFileIni(n),
                                         "=",
                                         RegexOptions.IgnoreCase)
                    If wMth_Compare.Success Then
                        Dim wStr_GetNameWorkTypeInFileIni As New StringBuilder()
                        For Each c As Char In wList_ListLineInFileIni(n)
                            If [Char].IsLetter(c) Or c = " " Then
                                wStr_GetNameWorkTypeInFileIni.Append(c)
                            End If
                        Next
                        lstWorkType.Items.Add(wStr_GetNameWorkTypeInFileIni)
                    End If
                    If wList_ListLineInFileIni(n) = "[WorkTypeDetail]" Then
                        Exit For
                    End If
                Next n
            End If
        Next m
        '-------------------------------------------------------
        lstWorkType.SelectionMode = SelectionMode.MultiExtended
        'Dim i As Integer
        For i As Integer = 0 To Me.lstWorkType.Items.Count - 1
            Me.lstWorkType.SetSelected(i, True)
        Next i
        '-------------------------------------------------------
        'Datagridview
        Dim wTbl_TableDataGrid As New DataTable()
        wTbl_TableDataGrid.Columns.Add("WorkType", Type.GetType("System.String"))
        wTbl_TableDataGrid.Columns.Add("Date", Type.GetType("System.String"))
        wTbl_TableDataGrid.Columns.Add("Shop CODE", Type.GetType("System.String"))
        wTbl_TableDataGrid.Columns.Add("Pos NO", Type.GetType("System.String"))
        wTbl_TableDataGrid.Columns.Add("Receipt Code", Type.GetType("System.String"))
        wTbl_TableDataGrid.Columns.Add("Manage Code", Type.GetType("System.String"))
        dgvInformationRecord.DataSource = wTbl_TableDataGrid
        '--------------------------------------------------------------------
        'Set DATE TIME
        subM_APP_SetDefaultDateTime()
        '------------------------------------------------------------------- 
        'ComboBox
        cmbFontReceiptSize.Items.Add("9")
        cmbFontReceiptSize.Items.Add("12")
        cmbFontReceiptSize.Items.Add("15")
        cmbFontReceiptSize.Items.Add("18")
        cmbFontReceiptSize.Items.Add("21")
        cmbFontReceiptSize.Items.Add("24")
        cmbFontReceiptSize.SelectedIndex = 0
        cmbFontReceiptSize.MaxLength = 2
        'TextBox
        txtShopCode.TextAlign = HorizontalAlignment.Right
        txtShopCode.MaxLength = 4
        txtPosNo.TextAlign = HorizontalAlignment.Right
        txtPosNo.MaxLength = 2
        txtReceiptCode.TextAlign = HorizontalAlignment.Right
        txtReceiptCode.MaxLength = 8
        txtShopCode.Text = 0
        txtPosNo.Text = 0
        txtReceiptCode.Text = 0
        'Block Type RichTextBox
        rtbReceiptDetail.ReadOnly = True
        rtbReceiptDetail.ScrollBars = RichTextBoxScrollBars.Both
        'RichTextBox1.WordWrap = False
        mvInt_FlagClose = 1
    End Sub

    Private Sub frm_APP_SearchForm_KeyDown(sender As Object, e As KeyEventArgs) Handles MyBase.KeyDown
        'e.SuppressKeyPress = True
        If Control.ModifierKeys = Keys.Alt Then
            If e.KeyCode = Keys.C Then
                e.Handled = True
                txtShopCode.Focus()
            End If
        End If
        If Control.ModifierKeys = Keys.Alt Then
            If e.KeyCode = Keys.P Then
                e.Handled = True
                txtPosNo.Focus()
            End If
        End If
        If Control.ModifierKeys = Keys.Alt Then
            If e.KeyCode = Keys.R Then
                e.Handled = True
                txtReceiptCode.Focus()
            End If
        End If
        If Control.ModifierKeys = Keys.Alt Then
            If e.KeyCode = Keys.D Then
                e.Handled = True
                dtmStart.Focus()
            End If
        End If
        If Control.ModifierKeys = Keys.Alt Then
            If e.KeyCode = Keys.T Then
                e.Handled = True
                dtmFinish.Focus()
            End If
        End If
        If Control.ModifierKeys = Keys.Alt Then
            If e.KeyCode = Keys.Y Then
                e.Handled = True
                If Not rtbReceiptDetail.Text = "" Then
                    If pdgPrintDialog.ShowDialog = DialogResult.OK Then
                        pdtPrintDocument.Print()
                    End If
                End If
            End If
        End If
        If Control.ModifierKeys = Keys.Alt Then
            If e.KeyCode = Keys.X Then
                e.Handled = True
                If MsgBox("Exit ??", MsgBoxStyle.YesNo Or MsgBoxStyle.Question,
               "Warning") = vbYes Then
                    Close()
                End If
            End If
        End If
        If Control.ModifierKeys = Keys.Alt Then
            If e.KeyCode = Keys.F Then
                e.Handled = True
                cmbFontReceiptSize.Focus()
            End If
        End If
        If Control.ModifierKeys = Keys.Alt Then
            If e.KeyCode = Keys.H Then
                e.Handled = True
                Process.Start(mvStr_AppPath + "\jlview.hlp")
            End If
        End If
        If Control.ModifierKeys = Keys.Alt And mvInt_EventSearchCancel Mod 2 = 0 Then
            If e.KeyCode = Keys.S Then
                e.Handled = True
                Me.cmdSearch.PerformClick()
            End If
        End If
        If Control.ModifierKeys = Keys.Alt And mvInt_EventSearchCancel Mod 2 = 1 Then
            If e.KeyCode = Keys.E Then
                e.Handled = True
                Me.cmdSearch.PerformClick()
            End If
        End If
    End Sub

    Private Sub frm_APP_SearchForm_FormClosing(sender As Object, e As FormClosingEventArgs) Handles MyBase.FormClosing
        If mvInt_FlagClose = 1 Then
            If MsgBox("Exit ??", MsgBoxStyle.YesNo Or MsgBoxStyle.Question,
               "Warning") = vbNo Then
                e.Cancel = True
            End If
        End If
    End Sub

    Private Sub lstWorkType_SelectedIndexChanged(sender As Object, e As EventArgs) Handles lstWorkType.SelectedIndexChanged
        For i = mvLst_ListWorkType.Count - 1 To 0 Step -1
            mvLst_ListWorkType.RemoveAt(i)
        Next
        For l As Integer = 0 To lstWorkType.SelectedItems.Count - 1 Step +1
            mvLst_ListWorkType.Add(lstWorkType.SelectedItems.Item(l).ToString)
        Next l
    End Sub

    Private Sub mnsPrint_Click(sender As Object, e As EventArgs) Handles mnsPrint.Click
        'PrintDialog1.ShowDialog()
        If Not rtbReceiptDetail.Text = "" Then
            If pdgPrintDialog.ShowDialog = DialogResult.OK Then
                pdtPrintDocument.Print()
            End If
        End If
    End Sub

    Private Sub dgvInformationRecord_Sorted(sender As Object, e As EventArgs) Handles dgvInformationRecord.Sorted
        If dgvInformationRecord.RowCount > 1 Then
            For i As Integer = 0 To dgvInformationRecord.Rows.Count - 2
                dgvInformationRecord.Rows(i).DefaultCellStyle.BackColor = Color.LightGreen
                i = i + 1
            Next
        End If

    End Sub

    Private Sub dgvInformationRecord_DataBindingComplete(sender As Object, e As DataGridViewBindingCompleteEventArgs) Handles dgvInformationRecord.DataBindingComplete

        If dgvInformationRecord.RowCount > 1 Then
            For i As Integer = 0 To dgvInformationRecord.Rows.Count - 2
                dgvInformationRecord.Rows(i).DefaultCellStyle.BackColor = Color.LightGreen
                i = i + 1
            Next
        End If
    End Sub

    Private Sub dgvInformationRecord_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles dgvInformationRecord.CellClick
        rtbReceiptDetail.Clear()
        If dgvInformationRecord.RowCount > 1 Then
            If e.RowIndex < dgvInformationRecord.RowCount - 1 Then
                'Dim list As System.Collections.ObjectModel.
                ' ReadOnlyCollection(Of String)
                'list = My.Computer.FileSystem.FindInFiles(appPath + "\", DataGridView1.Rows(DataGridView1.CurrentRow.Index).Cells("Manage Code").Value.ToString, True, FileIO.SearchOption.SearchTopLevelOnly)
                ''--------------------------------------------------------
                Dim wLst_ValueAtCurrentRow() As String
                'Dim line() As String
                'line = File.ReadAllLines(list(0))
                'For m As Integer = 0 To line.Length - 1 Step +1
                '    If line(m).Contains(DataGridView1.Rows(DataGridView1.CurrentRow.Index).Cells("Manage Code").Value.ToString) Then
                '        value = line(m).ToString.Split("	")
                '    End If
                'Next m
                If mvFso_GetAllFileDat.Length > 0 Then
                    For m As Integer = 0 To mvLst_ListDataGridView.Count - 1 Step +1
                        If mvLst_ListDataGridView(m).Contains(dgvInformationRecord.Rows(dgvInformationRecord.CurrentRow.Index).Cells("Manage Code").Value.ToString) Then
                            wLst_ValueAtCurrentRow = mvLst_ListDataGridView(m).Split(vbTab)
                            Exit For
                        End If
                    Next
                    'value = listDataGridView(dgvInformationRecord.CurrentRow.Index).Split("	")
                    Dim wStr_LineStart As String
                    Dim wStr_CountLine As String
                    Dim wStr_NameFileDat As String

                    wStr_LineStart = wLst_ValueAtCurrentRow(8)
                    wStr_CountLine = wLst_ValueAtCurrentRow(9)
                    wStr_NameFileDat = wLst_ValueAtCurrentRow(7)

                    '-----------------------------------------------------------
                    'Dim lineData() As String
                    'lineData = File.ReadAllLines(appPath + "\" + link)
                    Dim wLst_LineData As New List(Of String)
                    Using wStm_StreamReader As New System.IO.StreamReader(mvStr_AppPath + "\" + wStr_NameFileDat, System.Text.Encoding.Default)          '1
                        Do While wStm_StreamReader.Peek() <> -1
                            Dim wStr_ReadLine As String = wStm_StreamReader.ReadLine()
                            wLst_LineData.Add(wStr_ReadLine)
                        Loop
                        wStm_StreamReader.Close()
                    End Using

                    'Dong 0 
                    Dim wStr_Line0 As String = wLst_LineData(Convert.ToInt32(wStr_LineStart) - 1)
                    Dim wLst_ValueLine0() As String = wStr_Line0.ToString.Split("	")
                    'Dong 1
                    Dim wStr_Line1 As New List(Of String)
                    For k As Integer = Convert.ToInt32(wStr_LineStart) To Convert.ToInt32(wStr_LineStart) + Convert.ToInt32(wStr_CountLine) - 2 Step +1
                        Dim wLst_ValueLine1() As String
                        wLst_ValueLine1 = wLst_LineData(k).Split("	")
                        If wLst_ValueLine1(0) = "1" Then
                            wStr_Line1.Add(wLst_LineData(k))
                        End If
                    Next k
                    'Dong 2 
                    Dim wLst_Line2 As New List(Of String)
                    For h As Integer = Convert.ToInt32(wStr_LineStart) + wLst_Line2.Count To Convert.ToInt32(wStr_LineStart) + Convert.ToInt32(wStr_CountLine) - 2 Step +1
                        Dim wStr_ValueLine2() As String
                        wStr_ValueLine2 = wLst_LineData(h).Split("	")
                        If wStr_ValueLine2(0) = "2" Then
                            wLst_Line2.Add(wLst_LineData(h))
                        End If
                    Next h
                    'Dong 3
                    Dim wStr_Line3 As String = wLst_LineData(Convert.ToInt32(wStr_LineStart) + Convert.ToInt32(wStr_CountLine) - 2)
                    Dim wStr_ValueLine3() As String = wStr_Line3.ToString.Split("	")

                    Dim wInt_CurrentRowIndex As Integer
                    With dgvInformationRecord
                        If e.RowIndex >= 0 Then
                            wInt_CurrentRowIndex = .CurrentRow.Index
                            rtbReceiptDetail.AppendText(" [" + .Rows(wInt_CurrentRowIndex).Cells("WorkType").Value.ToString + "] ")
                            rtbReceiptDetail.AppendText(.Rows(wInt_CurrentRowIndex).Cells("Shop CODE").Value.ToString + "-")
                            rtbReceiptDetail.AppendText(.Rows(wInt_CurrentRowIndex).Cells("Pos NO").Value.ToString + "-")
                            rtbReceiptDetail.AppendText(.Rows(wInt_CurrentRowIndex).Cells("Receipt Code").Value.ToString + Environment.NewLine)
                            rtbReceiptDetail.AppendText("------------------------------------------------" + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Store Name                    " + vbTab + ": " + wLst_ValueLine0(9) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("POS NO                         " + vbTab + ": " + fncM_APP_DeleteChar0(.Rows(wInt_CurrentRowIndex).Cells("Pos NO").Value.ToString) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Receipt Code                  " + vbTab + ": " + fncM_APP_DeleteChar0(.Rows(wInt_CurrentRowIndex).Cells("Receipt Code").Value.ToString) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Work Day                       " + vbTab + ": " + fncM_APP_DayFormatInReceipt(.Rows(wInt_CurrentRowIndex).Cells("Date").Value.ToString) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Pos DayTime                  " + vbTab + ": " + wLst_ValueLine0(6) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("CD Staff                        " + vbTab + ": " + wLst_ValueLine0(15) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Name Staff                     " + vbTab + ": " + wLst_ValueLine0(16) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("CD Customer                  " + vbTab + ": " + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Name Customer              " + vbTab + ": " + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Total                             " + vbTab + ": " + wStr_Line1.Count.ToString + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Total Money                    " + vbTab + ": " + wLst_ValueLine0(19) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Tổng phụ                       " + vbTab + ": " + wLst_ValueLine0(20) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Tiền đưa                        " + vbTab + ": " + wLst_ValueLine0(21) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Tiền thối                        " + vbTab + ": " + wLst_ValueLine0(22) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Không  thuế                   " + vbTab + ": " + wLst_ValueLine0(23) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Tiền thuế                       " + vbTab + ": " + wLst_ValueLine0(27) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Điểm sử dụng                 " + vbTab + ": " + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Điểm cộng                      " + vbTab + ": " + Environment.NewLine)
                            rtbReceiptDetail.AppendText("------------------------------------------------" + Environment.NewLine)

                            For l1 As Integer = 0 To wStr_Line1.Count - 1 Step +1
                                Dim wLst_ValueLine1() As String
                                wLst_ValueLine1 = wStr_Line1(l1).Split("	")
                                rtbReceiptDetail.AppendText("ID item                          " + vbTab + ": " + (l1 + 1).ToString + Environment.NewLine)
                                rtbReceiptDetail.AppendText("ID PLU                          " + vbTab + ": " + wLst_ValueLine1(12) + Environment.NewLine)
                                rtbReceiptDetail.AppendText("Item Name                     " + vbTab + ": " + wLst_ValueLine1(10) + Environment.NewLine)
                                rtbReceiptDetail.AppendText("Tax Type                       " + vbTab + ": " + wLst_ValueLine1(11) + Environment.NewLine)
                                rtbReceiptDetail.AppendText("Total Sell                      " + vbTab + ": " + wLst_ValueLine1(7) + Environment.NewLine)
                                rtbReceiptDetail.AppendText("Sau chiết khấu                 " + vbTab + ": " + wLst_ValueLine1(8) + Environment.NewLine)
                                rtbReceiptDetail.AppendText("Tiền chiết khấu                " + vbTab + ": " + wLst_ValueLine1(9) + Environment.NewLine)
                                rtbReceiptDetail.AppendText("------------------------------------------------" + Environment.NewLine)
                            Next l1

                            For l2 As Integer = 0 To wLst_Line2.Count - 1 Step +1
                                Dim wLst_ValueLine2() As String
                                wLst_ValueLine2 = wLst_Line2(l2).Split("	")
                                rtbReceiptDetail.AppendText("Loaị Thanh Toán              " + vbTab + ": " + wLst_ValueLine2(11) + Environment.NewLine)
                                rtbReceiptDetail.AppendText("Số Tiền                          " + vbTab + ": " + wLst_ValueLine2(5) + Environment.NewLine)
                                rtbReceiptDetail.AppendText("------------------------------------------------" + Environment.NewLine)
                            Next l2
                            rtbReceiptDetail.AppendText("Chiết khấu                      " + vbTab + ": " + wStr_ValueLine3(7) + Environment.NewLine)
                            rtbReceiptDetail.AppendText("Số Tiền                          " + vbTab + ": " + wStr_ValueLine3(5) + Environment.NewLine)
                        End If
                    End With
                Else
                    MsgBox("Not Found DATA FILE", MsgBoxStyle.OkOnly Or MsgBoxStyle.Critical,
               "Warning")
                End If
            Else
                rtbReceiptDetail.Clear()
            End If
        End If
    End Sub

    Private Sub cmbFontReceiptSize_SelectedIndexChanged(sender As Object, e As EventArgs) Handles cmbFontReceiptSize.SelectedIndexChanged
        rtbReceiptDetail.WordWrap = False
        Dim fontSize As String
        fontSize = cmbFontReceiptSize.SelectedItem.ToString
        rtbReceiptDetail.Font = New Font("MS UI Gothic", Convert.ToInt32(fontSize), FontStyle.Regular)
    End Sub

    Private Sub cmbFontReceiptSize_KeyPress(sender As Object, e As KeyPressEventArgs) Handles cmbFontReceiptSize.KeyPress
        cmbFontReceiptSize.SelectAll()
        e.Handled = True
    End Sub

    Private Sub dgvInformationRecord_KeyUp(sender As Object, e As KeyEventArgs) Handles dgvInformationRecord.KeyUp
        rtbReceiptDetail.Clear()
        If dgvInformationRecord.CurrentRow.Index < dgvInformationRecord.RowCount - 1 Then
            'RichTextBox1.AppendText(DataGridView1.CurrentRow.Index.ToString + vbTab + DataGridView1.RowCount.ToString)
            Dim wLst_ValueAtCurrentRow() As String
            If mvFso_GetAllFileDat.Length > 0 Then
                wLst_ValueAtCurrentRow = mvLst_ListDataGridView(dgvInformationRecord.CurrentRow.Index).Split("	")
                Dim wStr_LineStart As String
                Dim wStr_CountLine As String
                Dim wStr_NameFileDat As String
                wStr_LineStart = wLst_ValueAtCurrentRow(8)
                wStr_CountLine = wLst_ValueAtCurrentRow(9)
                wStr_NameFileDat = wLst_ValueAtCurrentRow(7)
                '-----------------------------------------------------------
                'Dim lineData() As String
                'lineData = File.ReadAllLines(appPath + "\" + link)
                Dim wLst_LineData As New List(Of String)
                Using wStm_StreamReader As New System.IO.StreamReader(mvStr_AppPath + "\" + wStr_NameFileDat, System.Text.Encoding.Default)          '1
                    Do While wStm_StreamReader.Peek() <> -1
                        Dim Line As String = wStm_StreamReader.ReadLine()
                        wLst_LineData.Add(Line)
                    Loop
                    wStm_StreamReader.Close()
                End Using
                'Dong 0 
                Dim wStr_Line0 As String = wLst_LineData(Convert.ToInt32(wStr_LineStart) - 1)
                Dim wLst_ValueLine0() As String = wStr_Line0.ToString.Split("	")
                'Dong 1
                Dim wStr_Line1 As New List(Of String)
                For k As Integer = Convert.ToInt32(wStr_LineStart) To Convert.ToInt32(wStr_LineStart) + Convert.ToInt32(wStr_CountLine) - 2 Step +1
                    Dim wLst_ValueLine1() As String
                    wLst_ValueLine1 = wLst_LineData(k).Split("	")
                    If wLst_ValueLine1(0) = "1" Then
                        wStr_Line1.Add(wLst_LineData(k))
                    End If
                Next k
                'Dong 2 
                Dim wStr_Line2 As New List(Of String)
                For h As Integer = Convert.ToInt32(wStr_LineStart) + wStr_Line2.Count To Convert.ToInt32(wStr_LineStart) + Convert.ToInt32(wStr_CountLine) - 2 Step +1
                    Dim wLst_ValueLine2() As String
                    wLst_ValueLine2 = wLst_LineData(h).Split("	")
                    If wLst_ValueLine2(0) = "2" Then
                        wStr_Line2.Add(wLst_LineData(h))
                    End If
                Next h
                'Dong 3
                Dim wStr_Line3 As String = wLst_LineData(Convert.ToInt32(wStr_LineStart) + Convert.ToInt32(wStr_CountLine) - 2)
                Dim wLst_ValueLine3() As String = wStr_Line3.ToString.Split("	")
                Dim wInt_CurrentRowIndex As Integer
                With dgvInformationRecord
                    wInt_CurrentRowIndex = .CurrentRow.Index
                    rtbReceiptDetail.AppendText(" [" + .Rows(wInt_CurrentRowIndex).Cells("WorkType").Value.ToString + "] ")
                    rtbReceiptDetail.AppendText(.Rows(wInt_CurrentRowIndex).Cells("Shop CODE").Value.ToString + "-")
                    rtbReceiptDetail.AppendText(.Rows(wInt_CurrentRowIndex).Cells("Pos NO").Value.ToString + "-")
                    rtbReceiptDetail.AppendText(.Rows(wInt_CurrentRowIndex).Cells("Receipt Code").Value.ToString + Environment.NewLine)
                    rtbReceiptDetail.AppendText("----------------------------------------------------------" + Environment.NewLine)

                    rtbReceiptDetail.AppendText("Store Name                    " + vbTab + ": " + wLst_ValueLine0(9) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("POS NO                         " + vbTab + ": " + fncM_APP_DeleteChar0(.Rows(wInt_CurrentRowIndex).Cells("Pos NO").Value.ToString) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Receipt Code                  " + vbTab + ": " + fncM_APP_DeleteChar0(.Rows(wInt_CurrentRowIndex).Cells("Receipt Code").Value.ToString) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Work Day                       " + vbTab + ": " + fncM_APP_DayFormatInReceipt(.Rows(wInt_CurrentRowIndex).Cells("Date").Value.ToString) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Pos DayTime                  " + vbTab + ": " + wLst_ValueLine0(6) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("CD Staff                        " + vbTab + ": " + wLst_ValueLine0(15) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Name Staff                     " + vbTab + ": " + wLst_ValueLine0(16) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("CD Customer                  " + vbTab + ": " + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Name Customer              " + vbTab + ": " + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Total                             " + vbTab + ": " + wStr_Line1.Count.ToString + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Total Money                    " + vbTab + ": " + wLst_ValueLine0(19) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Tổng phụ                       " + vbTab + ": " + wLst_ValueLine0(20) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Tiền đưa                        " + vbTab + ": " + wLst_ValueLine0(21) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Tiền thối                        " + vbTab + ": " + wLst_ValueLine0(22) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Không  thuế                   " + vbTab + ": " + wLst_ValueLine0(23) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Tiền thuế                       " + vbTab + ": " + wLst_ValueLine0(27) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Điểm sử dụng                 " + vbTab + ": " + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Điểm cộng                      " + vbTab + ": " + Environment.NewLine)
                    rtbReceiptDetail.AppendText("----------------------------------------------------------" + Environment.NewLine)

                    For l1 As Integer = 0 To wStr_Line1.Count - 1 Step +1
                        Dim wLst_ValueLine1() As String
                        wLst_ValueLine1 = wStr_Line1(l1).Split("	")
                        rtbReceiptDetail.AppendText("ID item                          " + vbTab + ": " + (l1 + 1).ToString + Environment.NewLine)
                        rtbReceiptDetail.AppendText("ID PLU                          " + vbTab + ": " + wLst_ValueLine1(12) + Environment.NewLine)
                        rtbReceiptDetail.AppendText("Item Name                     " + vbTab + ": " + wLst_ValueLine1(10) + Environment.NewLine)
                        rtbReceiptDetail.AppendText("Tax Type                       " + vbTab + ": " + wLst_ValueLine1(11) + Environment.NewLine)
                        rtbReceiptDetail.AppendText("Total Sell                      " + vbTab + ": " + wLst_ValueLine1(7) + Environment.NewLine)
                        rtbReceiptDetail.AppendText("Sau chiết khấu                 " + vbTab + ": " + wLst_ValueLine1(8) + Environment.NewLine)
                        rtbReceiptDetail.AppendText("Tiền chiết khấu                " + vbTab + ": " + wLst_ValueLine1(9) + Environment.NewLine)
                        rtbReceiptDetail.AppendText("----------------------------------------------------------" + Environment.NewLine)
                    Next l1

                    For l2 As Integer = 0 To wStr_Line2.Count - 1 Step +1
                        Dim wLst_ValueLine2() As String
                        wLst_ValueLine2 = wStr_Line2(l2).Split("	")
                        rtbReceiptDetail.AppendText("Loaị Thanh Toán              " + vbTab + ": " + wLst_ValueLine2(11) + Environment.NewLine)
                        rtbReceiptDetail.AppendText("Số Tiền                          " + vbTab + ": " + wLst_ValueLine2(5) + Environment.NewLine)
                        rtbReceiptDetail.AppendText("----------------------------------------------------------" + Environment.NewLine)
                    Next l2
                    rtbReceiptDetail.AppendText("Chiết khấu                      " + vbTab + ": " + wLst_ValueLine3(7) + Environment.NewLine)
                    rtbReceiptDetail.AppendText("Số Tiền                          " + vbTab + ": " + wLst_ValueLine3(5) + Environment.NewLine)
                End With
            Else
                MsgBox("Not Found DATA FILE", MsgBoxStyle.OkOnly Or MsgBoxStyle.Critical,
                   "Warning")
            End If
        Else
            rtbReceiptDetail.Clear()
        End If
    End Sub


    Private Sub cmbFontReceiptSize_Click(sender As Object, e As EventArgs) Handles cmbFontReceiptSize.Click
        cmbFontReceiptSize.DroppedDown = True
    End Sub

    Private Sub mnsHelp_Click(sender As Object, e As EventArgs) Handles mnsHelp.Click
        'FileOpen(1, appPath + "\jlview.hlp", OpenMode.Input)
        Process.Start(mvStr_AppPath + "\jlview.hlp")
    End Sub

    Private Sub pdtPrintDocument_PrintPage(sender As Object, e As Printing.PrintPageEventArgs) Handles pdtPrintDocument.PrintPage
        Static wInt_CurrentChar As Integer
        Static wInt_CurrentLine As Integer
        Dim wFnt_TextFont As Font = rtbReceiptDetail.Font
        Dim wInt_Height As Integer
        Dim wInt_Witdh As Integer
        Dim wInt_Left As Integer
        Dim wInt_Top As Integer
        With pdtPrintDocument.DefaultPageSettings
            wInt_Height = .PaperSize.Height - .Margins.Top - .Margins.Bottom
            wInt_Witdh = .PaperSize.Width - .Margins.Left - .Margins.Right
            wInt_Left = pdtPrintDocument.DefaultPageSettings.Margins.Left
            wInt_Top = pdtPrintDocument.DefaultPageSettings.Margins.Top
        End With
        'Optional Rectangle Blue.
        'e.Graphics.DrawRectangle(Pens.Blue, New Rectangle(left, top, w, h))
        If pdtPrintDocument.DefaultPageSettings.Landscape Then
            Dim wInt_temp As Integer
            wInt_temp = wInt_Height
            wInt_Height = wInt_Witdh
            wInt_Witdh = wInt_temp
        End If
        Dim wInt_Lines As Integer
        wInt_Lines = CInt(Math.Round(wInt_Height / wFnt_TextFont.Height))
        Dim b As New Rectangle(wInt_Left, wInt_Top, wInt_Witdh, wInt_Height)
        Dim format As StringFormat
        If Not rtbReceiptDetail.WordWrap Then
            format = New StringFormat(StringFormatFlags.NoWrap)
            format.Trimming = StringTrimming.EllipsisWord
            Dim i As Integer
            For i = wInt_CurrentLine To Math.Min(wInt_CurrentLine + wInt_Lines, rtbReceiptDetail.Lines.Length - 1)
                e.Graphics.DrawString(rtbReceiptDetail.Lines(i), wFnt_TextFont, Brushes.Black, New RectangleF(wInt_Left, wInt_Top + wFnt_TextFont.Height * (i - wInt_CurrentLine), wInt_Witdh, wFnt_TextFont.Height), format)
            Next
            wInt_CurrentLine += wInt_Lines
            If wInt_CurrentLine >= txtShopCode.Lines.Length Then
                e.HasMorePages = False
                wInt_CurrentLine = 0
            Else
                e.HasMorePages = True
            End If
            Exit Sub
        End If
        format = New StringFormat(StringFormatFlags.LineLimit)
        Dim line, chars As Integer
        e.Graphics.MeasureString(Mid(rtbReceiptDetail.Text, wInt_CurrentChar + 1), wFnt_TextFont, New SizeF(wInt_Witdh, wInt_Height), format, chars, line)
        If wInt_CurrentChar + chars < rtbReceiptDetail.Text.Length Then
            If rtbReceiptDetail.Text.Substring(wInt_CurrentChar + chars, 1) <> " " And rtbReceiptDetail.Text.Substring(wInt_CurrentChar + chars, 1) <> vbLf Then
                While chars > 0
                    rtbReceiptDetail.Text.Substring(wInt_CurrentChar + chars, 1)
                    rtbReceiptDetail.Text.Substring(wInt_CurrentChar + chars, 1)
                    chars -= 1
                End While
                chars += 1
            End If
        End If
        e.Graphics.DrawString(rtbReceiptDetail.Text.Substring(wInt_CurrentChar, chars), wFnt_TextFont, Brushes.Black, b, format)
        wInt_CurrentChar = wInt_CurrentChar + chars
        If wInt_CurrentChar < rtbReceiptDetail.Text.Length Then
            e.HasMorePages = True
        Else
            e.HasMorePages = False
            wInt_CurrentChar = 0
        End If
    End Sub
End Class
